# auto annotate tracking video with SAM-2
Программа для автоматической разметки трекинга объекта на видео с помощью модели SAM

# Настройка окружения
Для работы основной программы нужно фактически настроить SAM2. </br>
Установить проще, используя conda. В корне проекта находится файл `environment.yml`, который можно использовать для создания окружения. </br>
С помощью этого файла окружение можно установить основные библиотеки даже для работы с программой, а также для работы SAM. </br>
Но в любом случае без запуска install самого SAM не обойдёмся. </br>

## !!!Важно!!!
* Разработчики SAM крайне рекомендуют использовать WSL если работаете в среде Windows. <i>If you are installing on Windows, it's strongly recommended to use Windows Subsystem for Linux (WSL) with Ubuntu.</i>
* У вас уже заранее должен быть настроен компьютер для поддержки CUDA ядер. conda конфиг далее будет использовать cuda 12.8.1
* Если у вас возникнут какие-то проблемы с настройкой окружения, то советую перейти на официальный репозиторий SAM-2: https://github.com/facebookresearch/sam2 и выполнить требования установки SAM. наверняка проблема будет связана с установкой SAM. Ведь моя программа по факту использует только библиотеку opencv и настроенную SAM.

## Шаги установки
1. Выдаём команду conda для создания окружения с нужными библиотеками. На самом деле там будут и исбыточные библиотеки, но они могут понадобиться если вдруг захотите поиграть с SAM напрямую </br>
```bash
conda env create -f environment.yml
```

2. После успешного создания окружения активируем его. </br>
```bash
conda activate sam_2`
```

<!-- 3. Загрузим код SAM с официального репозитория и разместим его в папке sam. </br>
```bash
git clone https://github.com/facebookresearch/sam2.git`
``` -->

3. Выполним команду install для SAM </br>
<!-- ```bash
cd sam2 && pip install -e . -->
```
```bash
pip install -e .
```

4. Установка должна быть выполнена без ошибок. </br>
    Оставаясь в той же папке, даём команду на скачивание большой модели SAM-2 в папку checkpoints </br>
```bash
wget https://dl.fbaipublicfiles.com/segment_anything_2/092824/sam2.1_hiera_large.pt -P checkpoints`
```

6. В результате в папке checkpoints должна оказаться большая модель. Если вам нужна поменьше, то скачивайте меньшую, только в коде нужно будет изменить ссылку и конфиг </br>
    Теперь можно открыть код. В среде разработке выбрать окружение sam-2

## Перед запуском кода

1. В коде указать правильные пути к модели, видео и папке для временных данных (**!!! осторожно !!! Временная папка всегда будет очищаться**) </br>

2. Можно запускать и размечать </br>

# Управление в программе
## Мышь
- **Левая кнопка клик**: установка/удаление позитивной точки запроса
- **Правая кнопка клик**: установка/удаление негативной точки запроса
- **CTRL + колесо мыши**: приближение/отдаление
## Клавиатура
- **'F'** - Следующий кадр
- **'D' и/или 'Пробел'** - Предыдущий кадр
- **'Удержание F или D или Пробел'** - перемещение через 10 кадров
- **'R'** - Сбросить все точки на текущем экране
- **'P'** - Выполнить предсказание разметки для всех кадров относительно заданных точек на разных кадрах.
- **'H'** - Отображать/не отображать ограничивающую рамку
- **'Q'** - Выход